<%= render 'layouts/header' %>
<section>
<p style="color: red"><%= flash[:notice] %></p>
<p>
  Event:
  <%= @event.name %>
</p>
<p>
  Start date:
  <%= @event.start_date %>
</p>
<p>
  End date:
  <%= @event.end_date %>
</p>
<p>
  Location:
  <%= @event.location %>
</p>
<p>
  <img src="<%= @event.image %>" width=250px, height=200px>
</p>
<% if Role.where(user_id: @user.id).where(event_id: @event.id)[0].is_owner? %>
  <%= render 'expense_list' %>
<% end %>
<h1> People <h1>
<table>
<tr>
  <th>Name</th>
  <th>Email</th>
  <th>Permission</th>
<% @people.each do |person| %>
  <tr>
    <td> <%= person.user.name %></td>
    <td> <%= person.user.email %></td>
    <td> <%= Role.where(user_id: person.user.id).where(event_id: @event.id)[0].permission %></td>
  </tr>
<%end%>
</table>
<br>
<span class="site-buttons">
<%= link_to 'Edit', edit_event_path(id: @event.id)  %> |
<%= link_to 'Invite Friends', event_invite_friends_path(event_id: @event.id) %> |
<%= link_to 'Finalize Event', event_path(event_id: @event.id, finalize: "true"), method: :put %>
<%= link_to 'Add Expense', new_event_expense_path(event_id: @event.id) %> |
<%= link_to 'See Expenses', event_expenses_path(event_id: @event.id) %>
</span>

<br>
Total Cost: $<%= '%.2f' % @total_cost %><br>
Total Paid: $<%= '%.2f' % @total_paid %><br>
<% if @total_owed && @total_owed >= 0 %>
  <span style="color:red">You Owe: $<%= '%.2f' % @total_owed.abs %></span>
<% elsif @total_owed && @total_owed < 0  %>
  <span style="color:green">You Are Owed: $<%= '%.2f' % @total_owed.abs %></span>
<% end %>
<br><br>
<br><br>



<script>

	$(document).ready(function() {

		$('#calendar').fullCalendar({
			header: {
				left: 'prev,next today',
				center: 'title',
				right: 'month,basicWeek,basicDay'
			},
			defaultDate: '<%= @event.start_date %>',
			editable: true,
			eventLimit: true, // allow "more" link when too many events
			events: [

				{
					title: '<%= @event.name %>',
					start: '<%= @event.start_date %>',
          end: '<%= @event.end_date %>',
				},

          <% @people.each do |person| %>
            {
              title: '<%= User.find(person.user_id).name %>',
              start: '<%= person.start_date %>',
              end: '<%= person.end_date %>',
            },
          <% end %>
		  ]
		});

	});

</script>




	<div id='calendar'></div>
</section>


